# 测试数据生成器说明文档

## 概述

本项目包含一个完整的测试数据生成系统，为社区关怀志愿者匹配系统生成模拟数据。系统会创建100条每种数据类型的记录，包括用户、请求、分类和收藏等。

## 生成的数据类型

### 1. 用户数据 (100个)
- **PIN用户** (39个): 需要帮助的社区成员
  - 包含紧急联系人信息
  - 医疗信息（疾病、药物、过敏等）
  - 个人偏好设置
- **CSR用户** (60个): 志愿者
  - 志愿服务技能列表
  - 可用时间安排
  - 服务评级和经验
- **管理员** (1个): 系统管理人员
  - **邮箱**: admin@community-care.com
  - **密码**: password123
  - 拥有最高管理权限
  - 负责整个平台的管理和维护

### 2. 服务分类 (7个)
- 医疗健康 (medical)
- 出行交通 (transportation)
- 购物代办 (shopping)
- 家政服务 (household)
- 技术支持 (technology)
- 陪伴服务 (companion)
- 其他服务 (other)

### 3. 服务请求 (100个)
- 不同状态分布：
  - 待处理 (pending)
  - 已匹配 (matched)
  - 已完成 (completed)
  - 已取消 (cancelled)
- 包含地理位置信息
- 紧急程度分级
- 志愿者分配和申请记录

### 4. 收藏记录 (约100个)
- CSR用户对感兴趣请求的收藏
- 包含备注和标签
- 提醒设置

## 使用方法

### 方法1: 使用批处理文件 (推荐)
```bash
# Windows批处理
./generate-test-data.bat

# PowerShell脚本
./generate-test-data.ps1
```

### 方法2: 使用npm脚本
```bash
cd backend
npm run generate-data
```

### 方法3: 直接运行
```bash
cd backend
node generate-test-data.js
```

## 数据验证

生成数据后，可以运行验证脚本确认数据完整性：

```bash
cd backend
npm run verify-data
# 或
node verify-test-data.js
```

## 管理员账户信息

系统会自动创建一个管理员账户，登录信息如下：

```bash
cd backend
npm run show-admin
# 或
node show-admin-info.js
```

**默认管理员登录信息:**
- 邮箱: admin@community-care.com
- 密码: password123
- 权限: 超级管理员（拥有所有权限）

验证内容包括：
- 数据数量统计
- 数据分布检查
- 关联关系验证
- 示例数据预览

## 数据特点

### 真实性模拟
- 中英文混合姓名
- 真实的中国城市地址
- 合理的时间安排
- 符合实际的服务需求

### 关联性完整
- 请求只能由PIN用户创建
- 收藏只能由CSR用户操作
- 志愿者分配严格验证用户类型
- 地理位置支持空间查询

### 多样性丰富
- 不同紧急程度的请求
- 多种服务分类覆盖
- 随机的用户偏好设置
- 丰富的状态组合

## 数据库配置

脚本会自动使用项目的数据库配置：
- 优先使用环境变量 `MONGODB_URI`
- 默认连接本地MongoDB: `mongodb://localhost:27017/csr_volunteer_db`

## 注意事项

1. **数据清理**: 脚本运行前会清除现有数据，请确保备份重要信息
2. **网络连接**: 需要稳定的数据库连接
3. **依赖安装**: 确保已安装所有npm依赖包
4. **时间消耗**: 生成100条每种类型数据约需要1-2分钟

## 故障排除

### 常见问题

1. **数据库连接失败**
   - 检查MongoDB服务是否运行
   - 验证连接字符串和凭据
   - 确认网络连接

2. **依赖包缺失**
   ```bash
   cd backend
   npm install
   ```

3. **权限问题**
   - 确保有数据库写入权限
   - 检查文件系统访问权限

### 错误日志
脚本会输出详细的错误信息，包括：
- 数据库连接状态
- 数据生成进度
- 错误详情和堆栈跟踪

## 输出示例

```
🚀 开始生成测试数据...

📦 数据库连接成功
🔗 连接地址: mongodb://localhost:27017/csr_volunteer_db
🧹 清除现有数据...
✅ 现有数据已清除

🧑‍💼 开始生成 100 个用户...
✅ 成功创建 100 个用户
📂 开始生成分类数据...
✅ 成功创建 7 个分类
📋 开始生成 100 个请求...
✅ 成功创建 100 个请求
⭐ 开始生成 100 个收藏记录...
✅ 成功创建 99 个收藏记录
🔗 开始更新请求的志愿者分配...
✅ 成功更新 32 个请求的志愿者分配

📊 数据生成完成统计:
👥 用户: 100 个
  - PIN用户: 39 个
  - CSR用户: 60 个
  - 管理员: 1 个
📂 分类: 7 个
📋 请求: 100 个
  - 待处理: 26 个
  - 已匹配: 26 个
  - 已完成: 22 个
  - 已取消: 26 个
⭐ 收藏: 100 个

🎉 测试数据生成完成！
```

## 技术细节

- **编程语言**: Node.js
- **数据库**: MongoDB with Mongoose ODM
- **数据生成**: 随机算法确保数据多样性
- **地理位置**: 支持2dsphere索引的GeoJSON格式
- **密码加密**: bcryptjs哈希加密
- **时间处理**: 合理的时间范围和过期机制

---

*此文档由测试数据生成器自动创建，确保数据生成过程的透明性和可重复性。*