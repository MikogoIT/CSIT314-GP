{"ast":null,"code":"// Reports.jsx - ä»… Platform Manager å¯è®¿é—®\nimport React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import{useAuth}from'../../context/AuthContext';import{ReportService}from'../../services/reportService';import{useLanguage}from'../../context/LanguageContext';import{isPlatformManager}from'../../utils/permissions';import'../../styles/reports.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const Reports=()=>{const navigate=useNavigate();const{user}=useAuth();const{currentLanguage,t}=useLanguage();// æƒé™æ£€æŸ¥ - åªæœ‰ Platform Manager å¯ä»¥è®¿é—®\nuseEffect(()=>{if(!isPlatformManager(user)){alert(t('permission.denied')||'Access Denied: Platform Manager only');navigate('/admin/dashboard');}},[user,navigate,t]);const handleGoBack=()=>{navigate(-1);// è¿”å›žä¸Šä¸€é¡µ\n};const[reportType,setReportType]=useState('weekly');const[reportData,setReportData]=useState(null);const[reportDate,setReportDate]=useState(getDefaultDateForType('weekly'));const[loading,setLoading]=useState(false);// æ ¼å¼åŒ–æ—¥æœŸèŒƒå›´æ˜¾ç¤º\nfunction formatDateRangeDisplay(dateRange,type){if(!dateRange)return'';const[startStr,endStr]=dateRange.split(' - ');const startDate=new Date(startStr);const endDate=new Date(endStr);const formatOptions={year:'numeric',month:'2-digit',day:'2-digit'};switch(type){case'daily':return startDate.toLocaleDateString('zh-CN',formatOptions);case'weekly':return\"\".concat(startDate.toLocaleDateString('zh-CN',formatOptions),\" - \").concat(endDate.toLocaleDateString('zh-CN',formatOptions),\" (\\u7B2C\").concat(Math.ceil((startDate.getTime()-new Date(startDate.getFullYear(),0,1).getTime())/(7*24*60*60*1000)),\"\\u5468)\");case'monthly':return\"\".concat(startDate.getFullYear(),\"\\u5E74\").concat((startDate.getMonth()+1).toString().padStart(2,'0'),\"\\u6708\");default:return dateRange;}}// æ ¹æ®æŠ¥å‘Šç±»åž‹èŽ·å–é»˜è®¤æ—¥æœŸæ ¼å¼\nfunction getDefaultDateForType(type){const now=new Date();switch(type){case'daily':return now.toISOString().split('T')[0];// YYYY-MM-DD\ncase'weekly':// èŽ·å–å½“å‰å‘¨çš„æ ¼å¼ YYYY-W##\nconst year=now.getFullYear();const firstDay=new Date(year,0,1);const days=Math.ceil((now-firstDay)/(24*60*60*1000));const week=Math.ceil(days/7);return\"\".concat(year,\"-W\").concat(week.toString().padStart(2,'0'));case'monthly':return\"\".concat(now.getFullYear(),\"-\").concat((now.getMonth()+1).toString().padStart(2,'0'));// YYYY-MM\ndefault:return now.toISOString().split('T')[0];}}// å¤„ç†æŠ¥å‘Šç±»åž‹æ”¹å˜\nconst handleReportTypeChange=newType=>{setReportType(newType);setReportDate(getDefaultDateForType(newType));};const generateReport=async()=>{setLoading(true);try{let targetDate;switch(reportType){case'daily':targetDate=new Date(reportDate);break;case'weekly':// è§£æžå‘¨æ ¼å¼ YYYY-W##\nif(reportDate.includes('-W')){const[year,week]=reportDate.split('-W');const firstDayOfYear=new Date(year,0,1);const daysToAdd=(parseInt(week)-1)*7;targetDate=new Date(firstDayOfYear.getTime()+daysToAdd*24*60*60*1000);}else{targetDate=new Date(reportDate);}break;case'monthly':// è§£æžæœˆæ ¼å¼ YYYY-MM\nif(reportDate.includes('-')&&reportDate.length===7){const[year,month]=reportDate.split('-');targetDate=new Date(parseInt(year),parseInt(month)-1,15);// æœˆä¸­\n}else{targetDate=new Date(reportDate);}break;default:targetDate=new Date(reportDate);}const report=await ReportService.generateComprehensiveReport(reportType,targetDate);setReportData(report);}catch(error){console.error('ç”ŸæˆæŠ¥å‘Šå¤±è´¥:',error);}finally{setLoading(false);}};const downloadReport=async()=>{if(reportData){try{// ç›´æŽ¥ä¸‹è½½å½“å‰çš„æŠ¥å‘Šæ•°æ®\nReportService.exportReport(reportData,'system_report');}catch(error){console.error('ä¸‹è½½æŠ¥å‘Šå¤±è´¥:',error);alert(t('admin.reports.downloadError'));}}};// é¡µé¢åŠ è½½æ—¶ç”Ÿæˆé»˜è®¤æŠ¥å‘Š\nuseEffect(()=>{generateReport();},[]);// å½“æŠ¥å‘Šç±»åž‹æˆ–æ—¥æœŸæ”¹å˜æ—¶è‡ªåŠ¨é‡æ–°ç”ŸæˆæŠ¥å‘Š\nuseEffect(()=>{if(reportData){// åªæœ‰åœ¨å·²ç»æœ‰æŠ¥å‘Šæ•°æ®æ—¶æ‰è‡ªåŠ¨é‡æ–°ç”Ÿæˆ\ngenerateReport();}},[reportType,reportDate]);return/*#__PURE__*/_jsxs(\"div\",{className:\"admin-page\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modern-page-header\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"header-nav\",children:/*#__PURE__*/_jsxs(\"button\",{className:\"modern-back-btn\",onClick:handleGoBack,title:t('common.back')||'è¿”å›ž',children:[/*#__PURE__*/_jsx(\"span\",{className:\"back-icon\",children:\"\\u2190\"}),/*#__PURE__*/_jsx(\"span\",{className:\"back-text\",children:t('common.back')||'è¿”å›ž'})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header-main\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"header-icon\",children:\"\\uD83D\\uDCCA\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"header-text\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"modern-title\",children:t('admin.reports.title')}),/*#__PURE__*/_jsx(\"div\",{className:\"report-type-badge\",children:reportType==='daily'?t('admin.reports.daily'):reportType==='weekly'?t('admin.reports.weekly'):t('admin.reports.monthly')})]})]}),/*#__PURE__*/_jsx(\"p\",{className:\"modern-subtitle\",children:t('admin.reports.systemDataAnalysis')})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"report-config-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"config-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"config-title\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"config-icon\",children:\"\\u2699\\uFE0F\"}),/*#__PURE__*/_jsx(\"h3\",{children:t('admin.reports.config')})]}),/*#__PURE__*/_jsx(\"div\",{className:\"config-description\",children:t('configDescription')})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"config-body\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"config-section\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"config-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"config-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"item-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"item-icon\",children:\"\\uD83D\\uDCCB\"}),/*#__PURE__*/_jsx(\"label\",{className:\"item-label\",children:t('admin.reports.reportType')})]}),/*#__PURE__*/_jsxs(\"select\",{className:\"config-select\",value:reportType,onChange:e=>handleReportTypeChange(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"daily\",children:t('admin.reports.daily')}),/*#__PURE__*/_jsx(\"option\",{value:\"weekly\",children:t('admin.reports.weekly')}),/*#__PURE__*/_jsx(\"option\",{value:\"monthly\",children:t('admin.reports.monthly')})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"config-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"item-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"item-icon\",children:\"\\uD83D\\uDCC5\"}),/*#__PURE__*/_jsx(\"label\",{className:\"item-label\",children:reportType==='daily'?t('selectDate'):reportType==='weekly'?t('selectWeek'):t('selectMonth')})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"date-input-container\",children:[reportType==='daily'&&/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"config-input\",value:reportDate,onChange:e=>setReportDate(e.target.value)}),reportType==='weekly'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"input\",{type:\"week\",className:\"config-input\",value:reportDate,onChange:e=>setReportDate(e.target.value)}),/*#__PURE__*/_jsx(\"small\",{className:\"input-help\",children:t('weekHelp')})]}),reportType==='monthly'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"input\",{type:\"month\",className:\"config-input\",value:reportDate,onChange:e=>setReportDate(e.target.value)}),/*#__PURE__*/_jsx(\"small\",{className:\"input-help\",children:t('monthHelp')})]})]})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"config-actions\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"btn-generate\",onClick:generateReport,disabled:loading,children:[/*#__PURE__*/_jsx(\"span\",{className:\"btn-icon\",children:loading?'â³':'ðŸ“Š'}),/*#__PURE__*/_jsx(\"span\",{className:\"btn-text\",children:loading?t('admin.reports.generating'):t('admin.reports.generate')})]}),reportData&&/*#__PURE__*/_jsxs(\"button\",{className:\"btn-download\",onClick:downloadReport,children:[/*#__PURE__*/_jsx(\"span\",{className:\"btn-icon\",children:\"\\uD83D\\uDCBE\"}),/*#__PURE__*/_jsx(\"span\",{className:\"btn-text\",children:t('admin.reports.download')})]})]})]})]}),reportData&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"report-info\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"report-period\",children:[/*#__PURE__*/_jsxs(\"strong\",{children:[t('reportPeriod'),\":\"]}),\" \",formatDateRangeDisplay(reportData.dateRange,reportType)]}),/*#__PURE__*/_jsxs(\"div\",{className:\"report-generated\",children:[/*#__PURE__*/_jsxs(\"strong\",{children:[t('generatedAt'),\":\"]}),\" \",new Date().toLocaleString()]})]})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"stats-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card primary\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-title\",children:t('admin.reports.totalMatches')}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-value\",children:reportData.totalMatches})]}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-icon primary\",children:\"\\uD83E\\uDD1D\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-change \".concat(reportData.trends.matchGrowth>=0?'up':'down'),children:[reportData.trends.matchGrowth>=0?'â†—':'â†˜',reportType==='daily'?t('dailyGrowth'):reportType==='weekly'?t('weeklyGrowth'):t('monthlyGrowth'),reportData.trends.matchGrowth>=0?t('growth'):t('decrease'),\" \",Math.abs(reportData.trends.matchGrowth),\"%\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card success\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-title\",children:t('admin.reports.newUsers')}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-value\",children:reportData.newUsers})]}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-icon success\",children:\"\\uD83D\\uDC65\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-change \".concat(reportData.trends.userGrowth>=0?'up':'down'),children:[reportData.trends.userGrowth>=0?'â†—':'â†˜',reportType==='daily'?t('dailyGrowth'):reportType==='weekly'?t('weeklyGrowth'):t('monthlyGrowth'),reportData.trends.userGrowth>=0?t('growth'):t('decrease'),\" \",Math.abs(reportData.trends.userGrowth),\"%\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card warning\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-title\",children:t('admin.reports.activeRequests')}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-value\",children:reportData.activeRequests})]}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-icon warning\",children:\"\\uD83D\\uDCCB\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-change neutral\",children:t('admin.reports.currentActive')})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card info\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-title\",children:t('admin.reports.completionRate')}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-value\",children:reportData.completionRate})]}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-icon info\",children:\"\\u2705\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-change neutral\",children:t('admin.reports.periodCompletion')})]})]})]}),reportData&&reportData.details&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header\",children:/*#__PURE__*/_jsx(\"h3\",{className:\"card-title\",children:t('admin.reports.categoryBreakdown')})}),/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsx(\"div\",{className:\"category-stats\",children:Object.entries(reportData.details.categoryBreakdown).map(_ref=>{let[categoryId,data]=_ref;return/*#__PURE__*/_jsxs(\"div\",{className:\"category-stat-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"category-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"category-name\",children:data.name}),/*#__PURE__*/_jsxs(\"span\",{className:\"category-count\",children:[data.count,\" \",t('admin.reports.requests')]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"category-progress\",children:/*#__PURE__*/_jsx(\"div\",{className:\"progress-bar\",style:{width:\"\".concat(data.count>0?data.matched/data.count*100:0,\"%\")}})}),/*#__PURE__*/_jsxs(\"span\",{className:\"match-rate\",children:[data.count>0?Math.round(data.matched/data.count*100):0,\"% \",t('admin.reports.matched')]})]},categoryId);})})})]}),reportData.details.topPerformers&&reportData.details.topPerformers.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header\",children:/*#__PURE__*/_jsx(\"h3\",{className:\"card-title\",children:t('admin.reports.topPerformers')})}),/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsx(\"div\",{className:\"performers-list\",children:reportData.details.topPerformers.map((performer,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"performer-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"performer-rank\",children:[\"#\",index+1]}),/*#__PURE__*/_jsxs(\"div\",{className:\"performer-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"performer-name\",children:performer.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"performer-stats\",children:[performer.matches,\" \",t('admin.reports.matches'),\" \\u2022\",performer.categories.length,\" \",t('admin.reports.categories')]})]})]},performer.name))})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header\",children:/*#__PURE__*/_jsx(\"h3\",{className:\"card-title\",children:t('admin.reports.systemInfo')})}),/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"system-info-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"info-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"info-label\",children:t('admin.reports.reportType')}),/*#__PURE__*/_jsx(\"span\",{className:\"info-value\",children:reportData.reportType})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"info-label\",children:t('admin.reports.dateRange')}),/*#__PURE__*/_jsx(\"span\",{className:\"info-value\",children:reportData.dateRange})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"info-label\",children:t('generatedAt')}),/*#__PURE__*/_jsx(\"span\",{className:\"info-value\",children:new Date(reportData.generatedAt).toLocaleString()})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"info-label\",children:t('admin.reports.totalUsers')}),/*#__PURE__*/_jsx(\"span\",{className:\"info-value\",children:reportData.systemInfo.totalUsers})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"info-label\",children:t('admin.reports.totalRequests')}),/*#__PURE__*/_jsx(\"span\",{className:\"info-value\",children:reportData.systemInfo.totalRequests})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"info-label\",children:t('admin.reports.systemHealth')}),/*#__PURE__*/_jsx(\"span\",{className:\"info-value status-good\",children:reportData.systemInfo.systemHealth==='good'?t('admin.reports.healthy'):t('admin.reports.needsAttention')})]})]})})]})]})]});};export default Reports;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}