{"ast":null,"code":"// 报告生成服务\n// src/services/reportService.js\n\nexport class ReportService {\n  // 生成用户统计报告\n  static generateUserReport() {\n    const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');\n    const deletedUsers = JSON.parse(localStorage.getItem('deletedUsers') || '[]');\n    const report = {\n      title: '用户统计报告',\n      generatedAt: new Date().toISOString(),\n      data: {\n        totalUsers: registeredUsers.length,\n        activeUsers: registeredUsers.filter(u => u.status === 'active').length,\n        suspendedUsers: registeredUsers.filter(u => u.status === 'suspended').length,\n        deletedUsers: deletedUsers.length,\n        userTypes: {\n          pin: registeredUsers.filter(u => u.userType === 'pin').length,\n          csr: registeredUsers.filter(u => u.userType === 'csr').length,\n          admin: registeredUsers.filter(u => u.userType === 'admin').length\n        },\n        monthlyRegistrations: this.getMonthlyRegistrations(registeredUsers)\n      }\n    };\n    return report;\n  }\n\n  // 生成服务请求报告\n  static generateRequestReport() {\n    const requests = JSON.parse(localStorage.getItem('requests') || '[]');\n    const categories = JSON.parse(localStorage.getItem('categories') || '[]');\n    const report = {\n      title: '服务请求报告',\n      generatedAt: new Date().toISOString(),\n      data: {\n        totalRequests: requests.length,\n        pendingRequests: requests.filter(r => r.status === 'pending').length,\n        matchedRequests: requests.filter(r => r.status === 'matched').length,\n        completedRequests: requests.filter(r => r.status === 'completed').length,\n        cancelledRequests: requests.filter(r => r.status === 'cancelled').length,\n        categoryBreakdown: this.getCategoryBreakdown(requests),\n        monthlyRequests: this.getMonthlyRequests(requests)\n      }\n    };\n    return report;\n  }\n\n  // 生成综合报告\n  static generateComprehensiveReport() {\n    const userReport = this.generateUserReport();\n    const requestReport = this.generateRequestReport();\n    return {\n      title: '系统综合报告',\n      generatedAt: new Date().toISOString(),\n      userStats: userReport.data,\n      requestStats: requestReport.data,\n      systemHealth: {\n        dataIntegrity: 'good',\n        lastUpdate: new Date().toISOString(),\n        totalRecords: userReport.data.totalUsers + requestReport.data.totalRequests\n      }\n    };\n  }\n\n  // 获取月度注册统计\n  static getMonthlyRegistrations(users) {\n    const monthlyData = {};\n    const currentYear = new Date().getFullYear();\n\n    // 初始化12个月的数据\n    for (let i = 0; i < 12; i++) {\n      const month = new Date(currentYear, i, 1).toLocaleDateString('zh-CN', {\n        year: 'numeric',\n        month: 'long'\n      });\n      monthlyData[month] = 0;\n    }\n\n    // 统计每月注册数\n    users.forEach(user => {\n      const registrationDate = new Date(user.registeredAt || user.createdAt || Date.now());\n      if (registrationDate.getFullYear() === currentYear) {\n        const month = registrationDate.toLocaleDateString('zh-CN', {\n          year: 'numeric',\n          month: 'long'\n        });\n        if (monthlyData[month] !== undefined) {\n          monthlyData[month]++;\n        }\n      }\n    });\n    return monthlyData;\n  }\n\n  // 获取月度请求统计\n  static getMonthlyRequests(requests) {\n    const monthlyData = {};\n    const currentYear = new Date().getFullYear();\n\n    // 初始化12个月的数据\n    for (let i = 0; i < 12; i++) {\n      const month = new Date(currentYear, i, 1).toLocaleDateString('zh-CN', {\n        year: 'numeric',\n        month: 'long'\n      });\n      monthlyData[month] = 0;\n    }\n\n    // 统计每月请求数\n    requests.forEach(request => {\n      const requestDate = new Date(request.createdAt || Date.now());\n      if (requestDate.getFullYear() === currentYear) {\n        const month = requestDate.toLocaleDateString('zh-CN', {\n          year: 'numeric',\n          month: 'long'\n        });\n        if (monthlyData[month] !== undefined) {\n          monthlyData[month]++;\n        }\n      }\n    });\n    return monthlyData;\n  }\n\n  // 获取分类统计\n  static getCategoryBreakdown(requests) {\n    const categoryData = {};\n    requests.forEach(request => {\n      const category = request.category || '未分类';\n      categoryData[category] = (categoryData[category] || 0) + 1;\n    });\n    return categoryData;\n  }\n\n  // 下载报告为JSON文件\n  static downloadReport(report, filename) {\n    const dataStr = JSON.stringify(report, null, 2);\n    const dataBlob = new Blob([dataStr], {\n      type: 'application/json'\n    });\n    const link = document.createElement('a');\n    link.href = URL.createObjectURL(dataBlob);\n    link.download = `${filename}_${new Date().toISOString().split('T')[0]}.json`;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  }\n\n  // 生成并下载综合报告\n  static generateAndDownloadReport() {\n    const report = this.generateComprehensiveReport();\n    this.downloadReport(report, 'system_report');\n    return report;\n  }\n}","map":{"version":3,"names":["ReportService","generateUserReport","registeredUsers","JSON","parse","localStorage","getItem","deletedUsers","report","title","generatedAt","Date","toISOString","data","totalUsers","length","activeUsers","filter","u","status","suspendedUsers","userTypes","pin","userType","csr","admin","monthlyRegistrations","getMonthlyRegistrations","generateRequestReport","requests","categories","totalRequests","pendingRequests","r","matchedRequests","completedRequests","cancelledRequests","categoryBreakdown","getCategoryBreakdown","monthlyRequests","getMonthlyRequests","generateComprehensiveReport","userReport","requestReport","userStats","requestStats","systemHealth","dataIntegrity","lastUpdate","totalRecords","users","monthlyData","currentYear","getFullYear","i","month","toLocaleDateString","year","forEach","user","registrationDate","registeredAt","createdAt","now","undefined","request","requestDate","categoryData","category","downloadReport","filename","dataStr","stringify","dataBlob","Blob","type","link","document","createElement","href","URL","createObjectURL","download","split","body","appendChild","click","removeChild","generateAndDownloadReport"],"sources":["D:/Study/CSIT314-GP/src/services/reportService.js"],"sourcesContent":["// 报告生成服务\r\n// src/services/reportService.js\r\n\r\nexport class ReportService {\r\n  // 生成用户统计报告\r\n  static generateUserReport() {\r\n    const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');\r\n    const deletedUsers = JSON.parse(localStorage.getItem('deletedUsers') || '[]');\r\n    \r\n    const report = {\r\n      title: '用户统计报告',\r\n      generatedAt: new Date().toISOString(),\r\n      data: {\r\n        totalUsers: registeredUsers.length,\r\n        activeUsers: registeredUsers.filter(u => u.status === 'active').length,\r\n        suspendedUsers: registeredUsers.filter(u => u.status === 'suspended').length,\r\n        deletedUsers: deletedUsers.length,\r\n        userTypes: {\r\n          pin: registeredUsers.filter(u => u.userType === 'pin').length,\r\n          csr: registeredUsers.filter(u => u.userType === 'csr').length,\r\n          admin: registeredUsers.filter(u => u.userType === 'admin').length\r\n        },\r\n        monthlyRegistrations: this.getMonthlyRegistrations(registeredUsers)\r\n      }\r\n    };\r\n    \r\n    return report;\r\n  }\r\n  \r\n  // 生成服务请求报告\r\n  static generateRequestReport() {\r\n    const requests = JSON.parse(localStorage.getItem('requests') || '[]');\r\n    const categories = JSON.parse(localStorage.getItem('categories') || '[]');\r\n    \r\n    const report = {\r\n      title: '服务请求报告',\r\n      generatedAt: new Date().toISOString(),\r\n      data: {\r\n        totalRequests: requests.length,\r\n        pendingRequests: requests.filter(r => r.status === 'pending').length,\r\n        matchedRequests: requests.filter(r => r.status === 'matched').length,\r\n        completedRequests: requests.filter(r => r.status === 'completed').length,\r\n        cancelledRequests: requests.filter(r => r.status === 'cancelled').length,\r\n        categoryBreakdown: this.getCategoryBreakdown(requests),\r\n        monthlyRequests: this.getMonthlyRequests(requests)\r\n      }\r\n    };\r\n    \r\n    return report;\r\n  }\r\n  \r\n  // 生成综合报告\r\n  static generateComprehensiveReport() {\r\n    const userReport = this.generateUserReport();\r\n    const requestReport = this.generateRequestReport();\r\n    \r\n    return {\r\n      title: '系统综合报告',\r\n      generatedAt: new Date().toISOString(),\r\n      userStats: userReport.data,\r\n      requestStats: requestReport.data,\r\n      systemHealth: {\r\n        dataIntegrity: 'good',\r\n        lastUpdate: new Date().toISOString(),\r\n        totalRecords: userReport.data.totalUsers + requestReport.data.totalRequests\r\n      }\r\n    };\r\n  }\r\n  \r\n  // 获取月度注册统计\r\n  static getMonthlyRegistrations(users) {\r\n    const monthlyData = {};\r\n    const currentYear = new Date().getFullYear();\r\n    \r\n    // 初始化12个月的数据\r\n    for (let i = 0; i < 12; i++) {\r\n      const month = new Date(currentYear, i, 1).toLocaleDateString('zh-CN', { year: 'numeric', month: 'long' });\r\n      monthlyData[month] = 0;\r\n    }\r\n    \r\n    // 统计每月注册数\r\n    users.forEach(user => {\r\n      const registrationDate = new Date(user.registeredAt || user.createdAt || Date.now());\r\n      if (registrationDate.getFullYear() === currentYear) {\r\n        const month = registrationDate.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long' });\r\n        if (monthlyData[month] !== undefined) {\r\n          monthlyData[month]++;\r\n        }\r\n      }\r\n    });\r\n    \r\n    return monthlyData;\r\n  }\r\n  \r\n  // 获取月度请求统计\r\n  static getMonthlyRequests(requests) {\r\n    const monthlyData = {};\r\n    const currentYear = new Date().getFullYear();\r\n    \r\n    // 初始化12个月的数据\r\n    for (let i = 0; i < 12; i++) {\r\n      const month = new Date(currentYear, i, 1).toLocaleDateString('zh-CN', { year: 'numeric', month: 'long' });\r\n      monthlyData[month] = 0;\r\n    }\r\n    \r\n    // 统计每月请求数\r\n    requests.forEach(request => {\r\n      const requestDate = new Date(request.createdAt || Date.now());\r\n      if (requestDate.getFullYear() === currentYear) {\r\n        const month = requestDate.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long' });\r\n        if (monthlyData[month] !== undefined) {\r\n          monthlyData[month]++;\r\n        }\r\n      }\r\n    });\r\n    \r\n    return monthlyData;\r\n  }\r\n  \r\n  // 获取分类统计\r\n  static getCategoryBreakdown(requests) {\r\n    const categoryData = {};\r\n    \r\n    requests.forEach(request => {\r\n      const category = request.category || '未分类';\r\n      categoryData[category] = (categoryData[category] || 0) + 1;\r\n    });\r\n    \r\n    return categoryData;\r\n  }\r\n  \r\n  // 下载报告为JSON文件\r\n  static downloadReport(report, filename) {\r\n    const dataStr = JSON.stringify(report, null, 2);\r\n    const dataBlob = new Blob([dataStr], { type: 'application/json' });\r\n    \r\n    const link = document.createElement('a');\r\n    link.href = URL.createObjectURL(dataBlob);\r\n    link.download = `${filename}_${new Date().toISOString().split('T')[0]}.json`;\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n  }\r\n  \r\n  // 生成并下载综合报告\r\n  static generateAndDownloadReport() {\r\n    const report = this.generateComprehensiveReport();\r\n    this.downloadReport(report, 'system_report');\r\n    return report;\r\n  }\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}