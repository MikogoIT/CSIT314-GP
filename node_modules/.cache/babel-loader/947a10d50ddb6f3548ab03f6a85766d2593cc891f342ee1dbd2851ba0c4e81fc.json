{"ast":null,"code":"import _objectSpread from\"D:/Study/Git/CSIT314-GP/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{useAuth}from'../../context/AuthContext';import{useLanguage}from'../../context/LanguageContext';import Navbar from'../../components/Layout/Navbar';import'../../styles/profile.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const Profile=()=>{var _user$userType,_user$userType2;const{user,updateProfile}=useAuth();const{t}=useLanguage();const[formData,setFormData]=useState({name:'',email:'',phone:'',address:'',organization:'',emergencyContact:'',skills:[],avatar:''});const[isEditing,setIsEditing]=useState(false);const[isLoading,setIsLoading]=useState(false);const[message,setMessage]=useState({type:'',text:''});const[avatarPreview,setAvatarPreview]=useState('');useEffect(()=>{if(user){setFormData({name:user.name||'',email:user.email||'',phone:user.phone||'',address:user.address||'',organization:user.organization||'',emergencyContact:user.emergencyContact||'',skills:user.skills||[],avatar:user.avatar||''});setAvatarPreview(user.avatar||'');}},[user]);const handleInputChange=e=>{const{name,value}=e.target;setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:value}));};const handleSkillsChange=e=>{const{value,checked}=e.target;setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{skills:checked?[...prev.skills,value]:prev.skills.filter(skill=>skill!==value)}));};const handleAvatarChange=e=>{const file=e.target.files[0];if(file){// 检查文件大小 (最大2MB)\nif(file.size>2*1024*1024){setMessage({type:'error',text:t('profile.avatarTooLarge')||'头像文件大小不能超过2MB'});return;}// 检查文件类型\nif(!file.type.startsWith('image/')){setMessage({type:'error',text:t('profile.invalidImageType')||'请选择有效的图片文件'});return;}const reader=new FileReader();reader.onload=e=>{const base64=e.target.result;setAvatarPreview(base64);setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{avatar:base64}));};reader.readAsDataURL(file);}};const handleSubmit=async e=>{e.preventDefault();setIsLoading(true);setMessage({type:'',text:''});try{// 这里可以调用API更新用户信息\n// 目前使用本地存储模拟\nconst updatedUser=_objectSpread(_objectSpread(_objectSpread({},user),formData),{},{updatedAt:new Date().toISOString()});// 更新localStorage中的用户信息\nlocalStorage.setItem('user',JSON.stringify(updatedUser));// 如果有updateProfile方法，调用它\nif(updateProfile){await updateProfile(formData);}setMessage({type:'success',text:t('profile.updateSuccess')||'个人信息更新成功！'});setIsEditing(false);// 刷新页面以更新navbar中的用户信息\nsetTimeout(()=>{window.location.reload();},1500);}catch(error){console.error('Profile update error:',error);setMessage({type:'error',text:t('profile.updateError')||'更新失败，请重试'});}finally{setIsLoading(false);}};const handleCancel=()=>{// 重置表单数据\nsetFormData({name:user.name||'',email:user.email||'',phone:user.phone||'',address:user.address||'',organization:user.organization||'',emergencyContact:user.emergencyContact||'',skills:user.skills||[],avatar:user.avatar||''});setAvatarPreview(user.avatar||'');setIsEditing(false);setMessage({type:'',text:''});};const getDefaultAvatar=()=>{var _user$name,_user$name$charAt;return(user===null||user===void 0?void 0:(_user$name=user.name)===null||_user$name===void 0?void 0:(_user$name$charAt=_user$name.charAt(0))===null||_user$name$charAt===void 0?void 0:_user$name$charAt.toUpperCase())||'U';};const availableSkills=[{value:'medical',label:t('skills.medical')||'医疗护理'},{value:'transport',label:t('skills.transport')||'交通出行'},{value:'technology',label:t('skills.technology')||'技术支持'},{value:'education',label:t('skills.education')||'教育培训'},{value:'household',label:t('skills.household')||'家务服务'},{value:'companion',label:t('skills.companion')||'陪伴关怀'}];return/*#__PURE__*/_jsxs(\"div\",{className:\"page-container\",children:[/*#__PURE__*/_jsx(Navbar,{userType:user===null||user===void 0?void 0:user.userType,user:user}),/*#__PURE__*/_jsx(\"div\",{className:\"main-content\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"profile-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"profile-header\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"profile-avatar-section\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"avatar-container\",children:[avatarPreview?/*#__PURE__*/_jsx(\"img\",{src:avatarPreview,alt:\"Avatar\",className:\"profile-avatar-image\"}):/*#__PURE__*/_jsx(\"div\",{className:\"profile-avatar-placeholder\",children:getDefaultAvatar()}),isEditing&&/*#__PURE__*/_jsxs(\"div\",{className:\"avatar-upload\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",id:\"avatar-upload\",accept:\"image/*\",onChange:handleAvatarChange,className:\"avatar-input\"}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"avatar-upload\",className:\"avatar-upload-btn\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"upload-icon\",children:\"\\uD83D\\uDCF7\"}),t('profile.changeAvatar')||'更换头像']})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"profile-info\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"profile-name\",children:(user===null||user===void 0?void 0:user.name)||t('profile.noName')}),/*#__PURE__*/_jsx(\"div\",{className:\"profile-role\",children:/*#__PURE__*/_jsx(\"span\",{className:\"role-badge role-\".concat(user===null||user===void 0?void 0:user.userType),children:(user===null||user===void 0?void 0:(_user$userType=user.userType)===null||_user$userType===void 0?void 0:_user$userType.toUpperCase())||'USER'})}),/*#__PURE__*/_jsx(\"div\",{className:\"profile-actions\",children:!isEditing?/*#__PURE__*/_jsxs(\"button\",{className:\"btn btn-primary\",onClick:()=>setIsEditing(true),children:[/*#__PURE__*/_jsx(\"span\",{className:\"btn-icon\",children:\"\\u270F\\uFE0F\"}),t('profile.editProfile')||'编辑资料']}):/*#__PURE__*/_jsxs(\"div\",{className:\"edit-actions\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-secondary\",onClick:handleCancel,disabled:isLoading,children:t('common.cancel')||'取消'}),/*#__PURE__*/_jsxs(\"button\",{type:\"submit\",form:\"profile-form\",className:\"btn btn-primary\",disabled:isLoading,children:[isLoading&&/*#__PURE__*/_jsx(\"span\",{className:\"loading-spinner\"}),t('common.save')||'保存']})]})})]})]}),message.text&&/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-\".concat(message.type),children:message.text}),/*#__PURE__*/_jsx(\"div\",{className:\"profile-content\",children:/*#__PURE__*/_jsxs(\"form\",{id:\"profile-form\",onSubmit:handleSubmit,className:\"profile-form\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-section\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"section-title\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"section-icon\",children:\"\\uD83D\\uDC64\"}),t('profile.basicInfo')||'基本信息']}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:t('profile.name')||'姓名'}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"name\",value:formData.name,onChange:handleInputChange,className:\"form-input\",disabled:!isEditing,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:t('profile.email')||'邮箱'}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",name:\"email\",value:formData.email,onChange:handleInputChange,className:\"form-input\",disabled:true// 邮箱通常不允许修改\n})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:t('profile.phone')||'电话'}),/*#__PURE__*/_jsx(\"input\",{type:\"tel\",name:\"phone\",value:formData.phone,onChange:handleInputChange,className:\"form-input\",disabled:!isEditing})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group form-group-full\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:t('profile.address')||'地址'}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"address\",value:formData.address,onChange:handleInputChange,className:\"form-input\",disabled:!isEditing})]})]})]}),(user===null||user===void 0?void 0:user.userType)==='pin'&&/*#__PURE__*/_jsxs(\"div\",{className:\"form-section\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"section-title\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"section-icon\",children:\"\\uD83C\\uDD98\"}),t('profile.emergencyInfo')||'紧急联系信息']}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:t('profile.emergencyContact')||'紧急联系人'}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"emergencyContact\",value:formData.emergencyContact,onChange:handleInputChange,className:\"form-input\",disabled:!isEditing,placeholder:t('profile.emergencyContactPlaceholder')||'姓名和电话'})]})]}),(user===null||user===void 0?void 0:user.userType)==='csr'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-section\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"section-title\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"section-icon\",children:\"\\uD83C\\uDFE2\"}),t('profile.workInfo')||'工作信息']}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:t('profile.organization')||'所属机构'}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"organization\",value:formData.organization,onChange:handleInputChange,className:\"form-input\",disabled:!isEditing})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-section\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"section-title\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"section-icon\",children:\"\\uD83D\\uDEE0\\uFE0F\"}),t('profile.skills')||'技能专长']}),/*#__PURE__*/_jsx(\"div\",{className:\"skills-grid\",children:availableSkills.map(skill=>/*#__PURE__*/_jsxs(\"label\",{className:\"skill-checkbox\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",value:skill.value,checked:formData.skills.includes(skill.value),onChange:handleSkillsChange,disabled:!isEditing}),/*#__PURE__*/_jsx(\"span\",{className:\"skill-label\",children:skill.label})]},skill.value))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-section\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"section-title\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"section-icon\",children:\"\\u2139\\uFE0F\"}),t('profile.accountInfo')||'账户信息']}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"info-item\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[t('profile.userType')||'用户类型',\":\"]}),/*#__PURE__*/_jsx(\"span\",{className:\"user-type-badge \".concat(user===null||user===void 0?void 0:user.userType),children:(user===null||user===void 0?void 0:(_user$userType2=user.userType)===null||_user$userType2===void 0?void 0:_user$userType2.toUpperCase())||'N/A'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-item\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[t('profile.joinDate')||'注册时间',\":\"]}),/*#__PURE__*/_jsx(\"span\",{children:user!==null&&user!==void 0&&user.createdAt?new Date(user.createdAt).toLocaleDateString('zh-CN'):'N/A'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-item\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[t('profile.lastUpdate')||'最后更新',\":\"]}),/*#__PURE__*/_jsx(\"span\",{children:user!==null&&user!==void 0&&user.updatedAt?new Date(user.updatedAt).toLocaleDateString('zh-CN'):'N/A'})]})]})]})]})})]})})]});};export default Profile;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}