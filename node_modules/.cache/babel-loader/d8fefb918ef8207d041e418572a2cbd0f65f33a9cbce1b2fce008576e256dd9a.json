{"ast":null,"code":"import _objectSpread from\"D:/Study/Git/CSIT314-GP/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{useAuth}from'../../context/AuthContext';import{useLanguage}from'../../context/LanguageContext';import{DataService}from'../../services/dataService';import Navbar from'../../components/Layout/Navbar';import RequestDetailModal from'../../components/PIN/RequestDetailModal';import'../../styles/history.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CSRHistory=()=>{const{user}=useAuth();const{t}=useLanguage();const[serviceRecords,setServiceRecords]=useState([]);const[filteredRecords,setFilteredRecords]=useState([]);const[showRequestDetail,setShowRequestDetail]=useState(null);const[filters,setFilters]=useState({serviceType:'',startDate:'',endDate:''});useEffect(()=>{if(user!==null&&user!==void 0&&user.id){loadServiceRecords();}},[user===null||user===void 0?void 0:user.id]);useEffect(()=>{applyFilters();},[serviceRecords,filters]);const loadServiceRecords=async()=>{try{await DataService.initializeData();const allRequests=await DataService.getRequests();const userServiceRecords=(allRequests||[]).filter(request=>request.volunteerId===user.id&&(request.status==='matched'||request.status==='completed')&&request.matchedAt);const sortedRecords=userServiceRecords.sort((a,b)=>new Date(b.matchedAt)-new Date(a.matchedAt));setServiceRecords(sortedRecords);}catch(error){console.error('Failed to load service history:',error);setServiceRecords([]);}};const applyFilters=()=>{let filtered=[...serviceRecords];if(filters.serviceType){filtered=filtered.filter(record=>record.category===filters.serviceType);}if(filters.startDate){filtered=filtered.filter(record=>{const matchDate=new Date(record.matchedAt);const startDate=new Date(filters.startDate);return matchDate>=startDate;});}if(filters.endDate){filtered=filtered.filter(record=>{const matchDate=new Date(record.matchedAt);const endDate=new Date(filters.endDate);endDate.setHours(23,59,59,999);// 包含结束日期的整天\nreturn matchDate<=endDate;});}setFilteredRecords(filtered);};const handleFilterChange=(field,value)=>{setFilters(prev=>_objectSpread(_objectSpread({},prev),{},{[field]:value}));};const handleViewDetail=record=>{setShowRequestDetail(record);};const getCategoryText=category=>{return t(\"category.\".concat(category))||category;};const getUrgencyColor=urgency=>{const colorMap={low:'success',medium:'warning',high:'danger',urgent:'critical'};return colorMap[urgency]||'default';};const getServiceStats=()=>{const totalServices=serviceRecords.length;const categoriesCount={};serviceRecords.forEach(record=>{categoriesCount[record.category]=(categoriesCount[record.category]||0)+1;});const mostActiveCategory=Object.keys(categoriesCount).reduce((a,b)=>categoriesCount[a]>categoriesCount[b]?a:b,'');return{totalServices,categoriesCount,mostActiveCategory};};const stats=getServiceStats();return/*#__PURE__*/_jsxs(\"div\",{className:\"page-container\",children:[/*#__PURE__*/_jsx(Navbar,{userType:\"csr\",user:user}),/*#__PURE__*/_jsx(\"div\",{className:\"main-content\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"history-page\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"page-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"page-title\",children:t('csr.history.title')}),/*#__PURE__*/_jsx(\"p\",{className:\"page-subtitle\",children:t('csr.history.subtitle')})]})}),serviceRecords.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"stats-section\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"stats-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-number\",children:stats.totalServices}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-label\",children:t('csr.history.totalServices')})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-number\",children:Object.keys(stats.categoriesCount).length}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-label\",children:t('csr.history.serviceTypes')})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-number\",children:getCategoryText(stats.mostActiveCategory)}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-label\",children:t('csr.history.mostActive')})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"filters-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"filters\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:t('csr.history.filterByType')}),/*#__PURE__*/_jsxs(\"select\",{value:filters.serviceType,onChange:e=>handleFilterChange('serviceType',e.target.value),className:\"filter-select\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:t('csr.history.allServiceTypes')}),/*#__PURE__*/_jsx(\"option\",{value:\"medical\",children:t('category.medical')}),/*#__PURE__*/_jsx(\"option\",{value:\"transportation\",children:t('category.transportation')}),/*#__PURE__*/_jsx(\"option\",{value:\"shopping\",children:t('category.shopping')}),/*#__PURE__*/_jsx(\"option\",{value:\"household\",children:t('category.household')}),/*#__PURE__*/_jsx(\"option\",{value:\"companion\",children:t('category.companion')}),/*#__PURE__*/_jsx(\"option\",{value:\"technology\",children:t('category.technology')}),/*#__PURE__*/_jsx(\"option\",{value:\"education\",children:t('category.education')}),/*#__PURE__*/_jsx(\"option\",{value:\"other\",children:t('category.other')})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:t('csr.history.startDate')}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:filters.startDate,onChange:e=>handleFilterChange('startDate',e.target.value),className:\"filter-input\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:t('csr.history.endDate')}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:filters.endDate,onChange:e=>handleFilterChange('endDate',e.target.value),className:\"filter-input\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"filter-actions\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary\",onClick:()=>setFilters({serviceType:'',startDate:'',endDate:''}),children:t('csr.history.clearFilters')})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"results-count\",children:t('csr.history.resultsFound',{count:filteredRecords.length})})]}),filteredRecords.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"history-list\",children:filteredRecords.map(record=>{var _record$location;return/*#__PURE__*/_jsxs(\"div\",{className:\"history-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card-title\",children:[/*#__PURE__*/_jsx(\"h3\",{children:record.title}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-meta\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"category-badge\",children:getCategoryText(record.category)}),/*#__PURE__*/_jsx(\"span\",{className:\"urgency-badge urgency-\".concat(getUrgencyColor(record.urgency)),children:t(\"urgency.\".concat(record.urgency||'medium'))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"service-info\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"requester-name\",children:[\"\\uD83D\\uDC64 \",t('csr.history.serviceObject'),\": \",record.requesterName||t('csr.history.unknown')]}),/*#__PURE__*/_jsxs(\"div\",{className:\"service-date\",children:[\"\\uD83E\\uDD1D \",t('csr.history.serviceDate'),\": \",new Date(record.matchedAt).toLocaleDateString()]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"description\",children:record.description}),/*#__PURE__*/_jsxs(\"div\",{className:\"service-details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"label\",children:[\"\\uD83D\\uDCCD \",t('csr.history.serviceLocation'),\":\"]}),/*#__PURE__*/_jsx(\"span\",{className:\"value\",children:((_record$location=record.location)===null||_record$location===void 0?void 0:_record$location.address)||record.location||t('csr.history.toBeConfirmed')})]}),record.expectedDate&&/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"label\",children:[\"\\uD83D\\uDD52 \",t('csr.history.expectedTime'),\":\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"value\",children:[new Date(record.expectedDate).toLocaleDateString(),record.expectedTime&&\" \".concat(record.expectedTime)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"label\",children:[\"\\uD83D\\uDCDE \",t('csr.history.contactInfo'),\":\"]}),/*#__PURE__*/_jsx(\"span\",{className:\"value\",children:record.requesterPhone||record.requesterEmail})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"card-actions\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:()=>handleViewDetail(record),children:t('common.viewDetails')})})]},record.id);})}):/*#__PURE__*/_jsxs(\"div\",{className:\"empty-state\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"empty-state-icon\",children:\"\\uD83E\\uDD1D\"}),/*#__PURE__*/_jsx(\"div\",{className:\"empty-state-title\",children:serviceRecords.length===0?t('csr.history.noRecords'):t('csr.history.noFilteredRecords')}),/*#__PURE__*/_jsx(\"div\",{className:\"empty-state-description\",children:serviceRecords.length===0?t('csr.history.noRecordsDesc'):t('csr.history.noFilteredRecordsDesc')}),serviceRecords.length===0&&/*#__PURE__*/_jsx(\"a\",{href:\"/csr/search\",className:\"btn btn-primary\",children:t('csr.history.browseOpportunities')})]})]})}),showRequestDetail&&/*#__PURE__*/_jsx(RequestDetailModal,{request:showRequestDetail,onClose:()=>setShowRequestDetail(null)})]});};export default CSRHistory;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}