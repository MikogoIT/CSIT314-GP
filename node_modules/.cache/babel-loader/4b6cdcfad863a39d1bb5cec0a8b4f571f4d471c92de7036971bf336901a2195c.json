{"ast":null,"code":"import _objectSpread from\"D:/Study/Git/CSIT314-GP/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState}from'react';import{useLanguage}from'../../context/LanguageContext';import{useAuth}from'../../context/AuthContext';import{DataService}from'../../services/dataService';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const RequestDetailModal=_ref=>{var _request$location;let{request,onClose}=_ref;const{t}=useLanguage();const{user}=useAuth();const[submitting,setSubmitting]=useState({});const[localRatings,setLocalRatings]=useState({});const[localFeedbacks,setLocalFeedbacks]=useState({});if(!request)return null;const getCategoryName=category=>{return t(\"category.\".concat(category))||category;};const getUrgencyName=urgency=>{const urgencyMap={low:'ä½Ž',medium:'ä¸­',high:'é«˜',urgent:'ç´§æ€¥'};return urgencyMap[urgency]||urgency;};const formatDateTime=(dateString,timeString)=>{if(dateString){const date=new Date(dateString);const formattedDate=date.toLocaleDateString('zh-CN');// å¤„ç†æ—¶é—´æ®µ\nlet timeDisplay='';if(timeString){const timeMap={'morning':'ä¸Šåˆ (9:00-12:00)','afternoon':'ä¸‹åˆ (12:00-18:00)','evening':'æ™šä¸Š (18:00-21:00)'};timeDisplay=timeMap[timeString]||timeString;return\"\".concat(formattedDate,\" \").concat(timeDisplay);}return formattedDate;}return'å¾…å®š';};return/*#__PURE__*/_jsx(\"div\",{className:\"modal-backdrop\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal modal-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"modal-title\",children:\"\\u8BF7\\u6C42\\u8BE6\\u60C5\"}),/*#__PURE__*/_jsx(\"button\",{className:\"modal-close\",onClick:onClose,type:\"button\",children:\"\\u2715\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"modal-body\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"request-detail\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"detail-section\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"detail-section-title\",children:\"\\u57FA\\u672C\\u4FE1\\u606F\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"detail-label\",children:\"\\u8BF7\\u6C42\\u6807\\u9898\"}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-value\",children:request.title})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"detail-label\",children:\"\\u670D\\u52A1\\u7C7B\\u578B\"}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-value\",children:/*#__PURE__*/_jsx(\"span\",{className:\"category-tag\",children:getCategoryName(request.category)})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"detail-label\",children:\"\\u7D27\\u6025\\u7A0B\\u5EA6\"}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-value\",children:/*#__PURE__*/_jsx(\"span\",{className:\"urgency-badge \".concat(request.urgency),children:getUrgencyName(request.urgency)})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"detail-label\",children:\"\\u72B6\\u6001\"}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-value\",children:/*#__PURE__*/_jsx(\"span\",{className:\"status-badge \".concat(request.status),children:request.status==='matched'?'å·²åŒ¹é…':request.status==='pending'?'ç­‰å¾…åŒ¹é…':request.status==='completed'?'å·²å®Œæˆ':'æœªçŸ¥çŠ¶æ€'})})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-section\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"detail-section-title\",children:\"\\u8BE6\\u7EC6\\u63CF\\u8FF0\"}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-description\",children:request.description||'æ— è¯¦ç»†æè¿°'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-section\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"detail-section-title\",children:\"\\u65F6\\u95F4\\u548C\\u5730\\u70B9\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"detail-label\",children:\"\\u670D\\u52A1\\u5730\\u70B9\"}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-value\",children:((_request$location=request.location)===null||_request$location===void 0?void 0:_request$location.address)||request.location||'å¾…ç¡®å®š'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"detail-label\",children:\"\\u671F\\u671B\\u65E5\\u671F\"}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-value\",children:formatDateTime(request.expectedDate,request.expectedTime)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"detail-label\",children:\"\\u9700\\u8981\\u5FD7\\u613F\\u8005\\u6570\\u91CF\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-value\",children:[request.volunteersNeeded||1,\" \\u4EBA\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"detail-label\",children:\"\\u8054\\u7CFB\\u65B9\\u5F0F\"}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-value\",children:request.contactMethod==='phone'?'ç”µè¯':request.contactMethod==='email'?'é‚®ç®±':request.contactMethod==='both'?'ç”µè¯å’Œé‚®ç®±':'å…¶ä»–'})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-section\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"detail-section-title\",children:\"\\u8BF7\\u6C42\\u4EBA\\u4FE1\\u606F\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"requester-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"requester-avatar\",children:\"\\uD83D\\uDC64\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"requester-details\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"requester-name\",children:request.requesterName||'æœªçŸ¥ç”¨æˆ·'}),request.requesterEmail&&/*#__PURE__*/_jsxs(\"div\",{className:\"requester-contact\",children:[\"\\uD83D\\uDCE7 \",request.requesterEmail]}),request.requesterPhone&&/*#__PURE__*/_jsxs(\"div\",{className:\"requester-contact\",children:[\"\\uD83D\\uDCDE \",request.requesterPhone]}),request.requesterAddress&&/*#__PURE__*/_jsxs(\"div\",{className:\"requester-contact\",children:[\"\\uD83D\\uDCCD \",request.requesterAddress]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-section\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"detail-section-title\",children:\"\\u7EDF\\u8BA1\\u4FE1\\u606F\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"stats-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"\\u6D4F\\u89C8\\u6B21\\u6570\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"stat-value\",children:[\"\\uD83D\\uDC41\\uFE0F \",request.viewCount||0]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"\\u6536\\u85CF\\u6B21\\u6570\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"stat-value\",children:[\"\\u2B50 \",request.shortlistCount||0]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"\\u521B\\u5EFA\\u65F6\\u95F4\"}),/*#__PURE__*/_jsx(\"span\",{className:\"stat-value\",children:request.createdAt?new Date(request.createdAt).toLocaleString('zh-CN'):'æœªçŸ¥'})]})]})]}),request.additionalNotes&&/*#__PURE__*/_jsxs(\"div\",{className:\"detail-section\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"detail-section-title\",children:\"\\u9644\\u52A0\\u8BF4\\u660E\"}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-notes\",children:request.additionalNotes})]}),(request.status==='matched'||request.status==='completed')&&request.assignedVolunteers&&request.assignedVolunteers.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"detail-section\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"detail-section-title\",children:[\"\\u5DF2\\u5206\\u914D\\u5FD7\\u613F\\u8005 (\",request.assignedVolunteers.length,\"\\u4EBA)\"]}),request.assignedVolunteers.map((volunteer,index)=>{var _volunteer$name;return/*#__PURE__*/_jsxs(\"div\",{className:\"volunteer-info\",style:{marginBottom:index<request.assignedVolunteers.length-1?'15px':'0'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"volunteer-avatar\",children:((_volunteer$name=volunteer.name)===null||_volunteer$name===void 0?void 0:_volunteer$name.charAt(0).toUpperCase())||'ðŸ‘¤'}),/*#__PURE__*/_jsxs(\"div\",{className:\"volunteer-details\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"volunteer-name\",children:volunteer.name||'æœªçŸ¥å¿—æ„¿è€…'}),volunteer.email&&/*#__PURE__*/_jsxs(\"div\",{className:\"volunteer-contact\",style:{fontSize:'0.9em',color:'#666'},children:[\"\\uD83D\\uDCE7 \",volunteer.email]}),volunteer.phone&&/*#__PURE__*/_jsxs(\"div\",{className:\"volunteer-contact\",style:{fontSize:'0.9em',color:'#666'},children:[\"\\uD83D\\uDCDE \",volunteer.phone]}),/*#__PURE__*/_jsxs(\"div\",{className:\"volunteer-status\",style:{fontSize:'0.85em',color:'#888',marginTop:'5px'},children:[\"\\u5206\\u914D\\u65F6\\u95F4: \",volunteer.assignedAt?new Date(volunteer.assignedAt).toLocaleString('zh-CN'):'æœªçŸ¥']}),volunteer.completedAt&&/*#__PURE__*/_jsxs(\"div\",{className:\"volunteer-status\",style:{fontSize:'0.85em',color:'#4caf50',marginTop:'3px'},children:[\"\\u2705 \\u5B8C\\u6210\\u65F6\\u95F4: \",new Date(volunteer.completedAt).toLocaleString('zh-CN')]}),volunteer.rating&&/*#__PURE__*/_jsxs(\"div\",{className:\"volunteer-rating\",style:{marginTop:'5px'},children:['â­'.repeat(volunteer.rating),\" (\",volunteer.rating,\"/5)\"]}),request.status==='completed'&&user&&(user.id===request.requesterId||user._id===request.requesterId||user.id===request.requester)&&!volunteer.rating&&/*#__PURE__*/_jsxs(\"div\",{className:\"volunteer-rating-form\",style:{marginTop:'8px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'6px'},children:t('request.rating.leaveRatingFor',{name:volunteer.name||t('common.volunteer')})}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'8px',alignItems:'center',marginBottom:'6px'},children:[/*#__PURE__*/_jsxs(\"select\",{value:localRatings[volunteer.id]||'',onChange:e=>setLocalRatings(prev=>_objectSpread(_objectSpread({},prev),{},{[volunteer.id]:parseInt(e.target.value)})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:t('request.rating.select')}),/*#__PURE__*/_jsx(\"option\",{value:1,children:\"1\"}),/*#__PURE__*/_jsx(\"option\",{value:2,children:\"2\"}),/*#__PURE__*/_jsx(\"option\",{value:3,children:\"3\"}),/*#__PURE__*/_jsx(\"option\",{value:4,children:\"4\"}),/*#__PURE__*/_jsx(\"option\",{value:5,children:\"5\"})]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",disabled:submitting[volunteer.id]||!localRatings[volunteer.id],onClick:async()=>{const rating=localRatings[volunteer.id];const feedback=localFeedbacks[volunteer.id]||'';if(!rating)return;try{setSubmitting(prev=>_objectSpread(_objectSpread({},prev),{},{[volunteer.id]:true}));await DataService.completeRequest(request.id,{rating,feedback,volunteerId:volunteer.id});// reflect locally\nvolunteer.rating=rating;if(feedback)volunteer.feedback=feedback;}catch(err){console.error('æäº¤è¯„åˆ†å¤±è´¥',err);alert(t('error.submitRating')||'æäº¤è¯„åˆ†å¤±è´¥');}finally{setSubmitting(prev=>_objectSpread(_objectSpread({},prev),{},{[volunteer.id]:false}));}},children:submitting[volunteer.id]?t('common.saving'):t('request.rating.submit')})]}),/*#__PURE__*/_jsx(\"textarea\",{placeholder:t('request.rating.feedbackPlaceholder'),value:localFeedbacks[volunteer.id]||'',onChange:e=>setLocalFeedbacks(prev=>_objectSpread(_objectSpread({},prev),{},{[volunteer.id]:e.target.value})),rows:3,style:{width:'100%',marginTop:'6px'}})]}),volunteer.feedback&&/*#__PURE__*/_jsxs(\"div\",{className:\"volunteer-feedback\",style:{marginTop:'8px',padding:'8px',backgroundColor:'#f5f5f5',borderRadius:'4px',fontSize:'0.9em'},children:[\"\\uD83D\\uDCAC \",volunteer.feedback]})]})]},index);})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"modal-footer\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary\",onClick:onClose,children:\"\\u5173\\u95ED\"})})]})});};export default RequestDetailModal;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}