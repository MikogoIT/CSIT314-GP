{"ast":null,"code":"import _objectSpread from\"D:/Study/Git/CSIT314-GP/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{DataService}from'./dataService';export class ReportService{static getDateRangeData(startDate,endDate,requests,users){const start=new Date(startDate);const end=new Date(endDate);const filteredRequests=requests.filter(request=>{const date=new Date(request.createdAt);return date>=start&&date<=end;});const filteredUsers=users.filter(user=>{const date=new Date(user.registeredAt||user.createdAt);return date>=start&&date<=end;});return{requests:filteredRequests,users:filteredUsers};}static async generateDailyReport(){let targetDate=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Date();const users=await DataService.getUsers();const requests=await DataService.getRequests();const today=new Date(targetDate);today.setHours(0,0,0,0);const tomorrow=new Date(today);tomorrow.setDate(tomorrow.getDate()+1);const{requests:todayRequests,users:todayUsers}=this.getDateRangeData(today.toISOString(),tomorrow.toISOString(),requests,users);const yesterday=new Date(today);yesterday.setDate(yesterday.getDate()-1);const{requests:yesterdayRequests,users:yesterdayUsers}=this.getDateRangeData(yesterday.toISOString(),today.toISOString(),requests,users);const todayMatched=todayRequests.filter(r=>r.status==='matched').length;const yesterdayMatched=yesterdayRequests.filter(r=>r.status==='matched').length;const matchGrowth=yesterdayMatched===0?todayMatched>0?100:0:Math.round((todayMatched-yesterdayMatched)/yesterdayMatched*100);const userGrowth=yesterdayUsers.length===0?todayUsers.length>0?100:0:Math.round((todayUsers.length-yesterdayUsers.length)/yesterdayUsers.length*100);const activeRequests=requests.filter(r=>r.status==='pending'||r.status==='matched').length;const completedToday=todayRequests.filter(r=>r.status==='completed').length;const totalProcessedToday=todayRequests.filter(r=>r.status!=='pending').length;const completionRate=totalProcessedToday===0?0:Math.round(completedToday/totalProcessedToday*100);return{reportType:'daily',date:today.toISOString().split('T')[0],totalMatches:todayMatched,newUsers:todayUsers.length,activeRequests:activeRequests,completionRate:\"\".concat(completionRate,\"%\"),trends:{matchGrowth:matchGrowth,userGrowth:userGrowth,completionRateChange:0},details:{categoryBreakdown:await this.getCategoryBreakdown(todayRequests),hourlyActivity:this.getHourlyActivity(todayRequests),userTypeBreakdown:this.getUserTypeBreakdown(todayUsers)}};}static async generateWeeklyReport(){let targetDate=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Date();const users=await DataService.getUsers();const requests=await DataService.getRequests();const date=new Date(targetDate);const dayOfWeek=date.getDay();const daysToMonday=dayOfWeek===0?-6:1-dayOfWeek;const startDate=new Date(date);startDate.setDate(date.getDate()+daysToMonday);startDate.setHours(0,0,0,0);const endDate=new Date(startDate);endDate.setDate(startDate.getDate()+6);endDate.setHours(23,59,59,999);const{requests:weekRequests,users:weekUsers}=this.getDateRangeData(startDate.toISOString(),endDate.toISOString(),requests,users);const lastWeekEnd=new Date(startDate);const lastWeekStart=new Date(lastWeekEnd);lastWeekStart.setDate(lastWeekStart.getDate()-7);const{requests:lastWeekRequests,users:lastWeekUsers}=this.getDateRangeData(lastWeekStart.toISOString(),lastWeekEnd.toISOString(),requests,users);const weekMatched=weekRequests.filter(r=>r.status==='matched').length;const lastWeekMatched=lastWeekRequests.filter(r=>r.status==='matched').length;const matchGrowth=lastWeekMatched===0?weekMatched>0?100:0:Math.round((weekMatched-lastWeekMatched)/lastWeekMatched*100);const userGrowth=lastWeekUsers.length===0?weekUsers.length>0?100:0:Math.round((weekUsers.length-lastWeekUsers.length)/lastWeekUsers.length*100);const activeRequests=requests.filter(r=>r.status==='pending'||r.status==='matched').length;const completedWeek=weekRequests.filter(r=>r.status==='completed').length;const totalProcessedWeek=weekRequests.filter(r=>r.status!=='pending').length;const completionRate=totalProcessedWeek===0?0:Math.round(completedWeek/totalProcessedWeek*100);return{reportType:'weekly',dateRange:\"\".concat(startDate.toISOString().split('T')[0],\" - \").concat(endDate.toISOString().split('T')[0]),totalMatches:weekMatched,newUsers:weekUsers.length,activeRequests:activeRequests,completionRate:\"\".concat(completionRate,\"%\"),trends:{matchGrowth:matchGrowth,userGrowth:userGrowth,completionRateChange:0},details:{categoryBreakdown:await this.getCategoryBreakdown(weekRequests),dailyActivity:this.getDailyActivity(weekRequests,startDate,endDate),userTypeBreakdown:this.getUserTypeBreakdown(weekUsers)}};}static async generateMonthlyReport(){let targetDate=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Date();const users=await DataService.getUsers();const requests=await DataService.getRequests();const endDate=new Date(targetDate);const startDate=new Date(endDate.getFullYear(),endDate.getMonth(),1);const{requests:monthRequests,users:monthUsers}=this.getDateRangeData(startDate.toISOString(),endDate.toISOString(),requests,users);const lastMonthEnd=new Date(startDate);lastMonthEnd.setDate(lastMonthEnd.getDate()-1);const lastMonthStart=new Date(lastMonthEnd.getFullYear(),lastMonthEnd.getMonth(),1);const{requests:lastMonthRequests,users:lastMonthUsers}=this.getDateRangeData(lastMonthStart.toISOString(),lastMonthEnd.toISOString(),requests,users);const monthMatched=monthRequests.filter(r=>r.status==='matched').length;const lastMonthMatched=lastMonthRequests.filter(r=>r.status==='matched').length;const matchGrowth=lastMonthMatched===0?monthMatched>0?100:0:Math.round((monthMatched-lastMonthMatched)/lastMonthMatched*100);const userGrowth=lastMonthUsers.length===0?monthUsers.length>0?100:0:Math.round((monthUsers.length-lastMonthUsers.length)/lastMonthUsers.length*100);const activeRequests=requests.filter(r=>r.status==='pending'||r.status==='matched').length;const completedMonth=monthRequests.filter(r=>r.status==='completed').length;const totalProcessedMonth=monthRequests.filter(r=>r.status!=='pending').length;const completionRate=totalProcessedMonth===0?0:Math.round(completedMonth/totalProcessedMonth*100);return{reportType:'monthly',dateRange:\"\".concat(startDate.toISOString().split('T')[0],\" - \").concat(endDate.toISOString().split('T')[0]),totalMatches:monthMatched,newUsers:monthUsers.length,activeRequests:activeRequests,completionRate:\"\".concat(completionRate,\"%\"),trends:{matchGrowth:matchGrowth,userGrowth:userGrowth,completionRateChange:0},details:{categoryBreakdown:await this.getCategoryBreakdown(monthRequests),weeklyActivity:this.getWeeklyActivity(monthRequests,startDate,endDate),userTypeBreakdown:this.getUserTypeBreakdown(monthUsers),topPerformers:this.getTopPerformers(monthRequests)}};}static async getCategoryBreakdown(requests){const categories=await DataService.getCategories();const breakdown={};categories.forEach(category=>{breakdown[category.id]={name:category.name,count:requests.filter(r=>r.category===category.id).length,matched:requests.filter(r=>r.category===category.id&&r.status==='matched').length};});return breakdown;}static getUserTypeBreakdown(users){return{pin:users.filter(u=>u.userType==='pin').length,csr:users.filter(u=>u.userType==='csr').length,system_admin:users.filter(u=>u.userType==='system_admin').length,platform_manager:users.filter(u=>u.userType==='platform_manager').length};}static getHourlyActivity(requests){const hourlyData=Array.from({length:24},(_,i)=>({hour:i,count:0}));requests.forEach(request=>{const hour=new Date(request.createdAt).getHours();hourlyData[hour].count++;});return hourlyData;}static getDailyActivity(requests,startDate,endDate){const dailyData=[];const current=new Date(startDate);while(current<=endDate){const dayStart=new Date(current);dayStart.setHours(0,0,0,0);const dayEnd=new Date(current);dayEnd.setHours(23,59,59,999);const dayRequests=requests.filter(request=>{const requestDate=new Date(request.createdAt);return requestDate>=dayStart&&requestDate<=dayEnd;});dailyData.push({date:current.toISOString().split('T')[0],count:dayRequests.length,matched:dayRequests.filter(r=>r.status==='matched').length});current.setDate(current.getDate()+1);}return dailyData;}static getWeeklyActivity(requests,startDate,endDate){const weeklyData=[];const current=new Date(startDate);while(current<=endDate){const weekStart=new Date(current);const weekEnd=new Date(current);weekEnd.setDate(weekEnd.getDate()+6);if(weekEnd>endDate){weekEnd.setTime(endDate.getTime());}const weekRequests=requests.filter(request=>{const requestDate=new Date(request.createdAt);return requestDate>=weekStart&&requestDate<=weekEnd;});weeklyData.push({weekStart:weekStart.toISOString().split('T')[0],weekEnd:weekEnd.toISOString().split('T')[0],count:weekRequests.length,matched:weekRequests.filter(r=>r.status==='matched').length});current.setDate(current.getDate()+7);}return weeklyData;}static getTopVolunteers(requests){const volunteerStats={};requests.filter(r=>r.status==='matched'&&r.volunteer).forEach(request=>{const volunteer=request.volunteer;if(!volunteerStats[volunteer]){volunteerStats[volunteer]={name:volunteer,matches:0,categories:new Set()};}volunteerStats[volunteer].matches++;volunteerStats[volunteer].categories.add(request.category);});return Object.values(volunteerStats).map(v=>_objectSpread(_objectSpread({},v),{},{categories:Array.from(v.categories)})).sort((a,b)=>b.matches-a.matches).slice(0,5);}static async generateComprehensiveReport(){let reportType=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'monthly';let targetDate=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Date();let report;switch(reportType){case'daily':report=await this.generateDailyReport(targetDate);break;case'weekly':report=await this.generateWeeklyReport(targetDate);break;case'monthly':report=await this.generateMonthlyReport(targetDate);break;default:report=await this.generateWeeklyReport(targetDate);}const allUsers=await DataService.getUsers();const allRequests=await DataService.getRequests();return _objectSpread(_objectSpread({},report),{},{generatedAt:new Date().toISOString(),systemInfo:{totalUsers:allUsers.length,totalRequests:allRequests.length,systemHealth:'good'}});}static formatReportText(report){const reportTypeNames={daily:'日报',weekly:'周报',monthly:'月报'};let text='';text+='='.repeat(60)+'\\n';text+=\"CSR\\u5FD7\\u613F\\u8005\\u5339\\u914D\\u7CFB\\uFFFD?- \".concat(reportTypeNames[report.reportType]||'报告',\"\\n\");text+='='.repeat(60)+'\\n\\n';text+=\"\\u62A5\\u544A\\u65E5\\u671F: \".concat(report.date,\"\\n\");text+=\"\\u751F\\u6210\\u65F6\\u95F4: \".concat(new Date(report.generatedAt).toLocaleString('zh-CN'),\"\\n\\n\");text+='-'.repeat(60)+'\\n';text+='核心指标\\n';text+='-'.repeat(60)+'\\n';text+=\"\\u603B\\u5339\\u914D\\u6570: \".concat(report.totalMatches,\" \\u6B21\\n\");text+=\"\\u65B0\\u589E\\u7528\\u6237: \".concat(report.newUsers,\" \\u4EBA\\n\");text+=\"\\u6D3B\\u8DC3\\u8BF7\\u6C42: \".concat(report.activeRequests,\" \\u4E2A\\n\");text+=\"\\u5B8C\\u6210\\uFFFD? \".concat(report.completionRate,\"\\n\\n\");text+='-'.repeat(60)+'\\n';text+='增长趋势\\n';text+='-'.repeat(60)+'\\n';text+=\"\\u5339\\u914D\\u589E\\u957F\\uFFFD? \".concat(report.trends.matchGrowth>0?'+':'').concat(report.trends.matchGrowth,\"%\\n\");text+=\"\\u7528\\u6237\\u589E\\u957F\\uFFFD? \".concat(report.trends.userGrowth>0?'+':'').concat(report.trends.userGrowth,\"%\\n\\n\");if(report.details.categoryBreakdown){text+='-'.repeat(60)+'\\n';text+='分类统计\\n';text+='-'.repeat(60)+'\\n';Object.entries(report.details.categoryBreakdown).forEach(_ref=>{let[key,data]=_ref;text+=\"\".concat(data.name,\": \").concat(data.count,\" \\u4E2A\\u8BF7\\uFFFD?(\\u5339\\u914D: \").concat(data.matched,\")\\n\");});text+='\\n';}if(report.details.userTypeBreakdown){text+='-'.repeat(60)+'\\n';text+='用户类型分布\\n';text+='-'.repeat(60)+'\\n';text+=\"PIN\\u7528\\u6237 (\\u9700\\u8981\\u5E2E\\uFFFD?: \".concat(report.details.userTypeBreakdown.pin,\" \\u4EBA\\n\");text+=\"CSR\\u5FD7\\u613F\\uFFFD? \".concat(report.details.userTypeBreakdown.csr,\" \\u4EBA\\n\");text+=\"\\u7BA1\\u7406\\uFFFD? \".concat(report.details.userTypeBreakdown.admin,\" \\u4EBA\\n\\n\");}if(report.details.topPerformers&&report.details.topPerformers.length>0){text+='-'.repeat(60)+'\\n';text+='优秀志愿�?(Top 5)\\n';text+='-'.repeat(60)+'\\n';report.details.topPerformers.forEach((volunteer,index)=>{text+=\"\".concat(index+1,\". \").concat(volunteer.name,\"\\n\");text+=\"   \\u5B8C\\u6210\\u5339\\u914D: \".concat(volunteer.matches,\" \\u6B21\\n\");text+=\"   \\u5E73\\u5747\\u8BC4\\u5206: \".concat(volunteer.averageRating.toFixed(1),\" \\u5206\\n\");text+=\"   \\u670D\\u52A1\\u7C7B\\u522B: \".concat(Array.from(volunteer.categories).join(', '),\"\\n\\n\");});}text+='-'.repeat(60)+'\\n';text+='系统信息\\n';text+='-'.repeat(60)+'\\n';text+=\"\\u603B\\u7528\\u6237\\u6570: \".concat(report.systemInfo.totalUsers,\" \\u4EBA\\n\");text+=\"\\u603B\\u8BF7\\u6C42\\u6570: \".concat(report.systemInfo.totalRequests,\" \\u4E2A\\n\");text+=\"\\u7CFB\\u7EDF\\u72B6\\uFFFD? \".concat(report.systemInfo.systemHealth==='good'?'良好':'异常',\"\\n\\n\");text+='='.repeat(60)+'\\n';text+='报告结束\\n';text+='='.repeat(60)+'\\n';return text;}static exportReportText(report,filename){const textContent=this.formatReportText(report);const textBlob=new Blob([textContent],{type:'text/plain;charset=utf-8;'});const link=document.createElement('a');link.href=URL.createObjectURL(textBlob);link.download=\"\".concat(filename,\"_\").concat(report.reportType,\"_\").concat(report.date,\".txt\");document.body.appendChild(link);link.click();document.body.removeChild(link);}static exportReportJSON(report,filename){const dataStr=JSON.stringify(report,null,2);const dataBlob=new Blob([dataStr],{type:'application/json'});const link=document.createElement('a');link.href=URL.createObjectURL(dataBlob);link.download=\"\".concat(filename,\"_\").concat(report.reportType,\"_\").concat(report.date,\".json\");document.body.appendChild(link);link.click();document.body.removeChild(link);}static exportReportCSV(report,filename){const csvData=[['Metric','Value','Growth'],['Total Matches',report.totalMatches,\"\".concat(report.trends.matchGrowth,\"%\")],['New Users',report.newUsers,\"\".concat(report.trends.userGrowth,\"%\")],['Active Requests',report.activeRequests,''],['Completion Rate',report.completionRate,'']];const csvContent=csvData.map(row=>row.join(',')).join('\\n');const csvBlob=new Blob([csvContent],{type:'text/csv;charset=utf-8;'});const link=document.createElement('a');link.href=URL.createObjectURL(csvBlob);link.download=\"\".concat(filename,\"_\").concat(report.reportType,\"_\").concat(new Date().toISOString().split('T')[0],\".csv\");document.body.appendChild(link);link.click();document.body.removeChild(link);}static async generateAndDownloadReport(reportType,targetDate){const report=await this.generateComprehensiveReport(reportType,targetDate);this.exportReport(report,'system_report');return report;}}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}