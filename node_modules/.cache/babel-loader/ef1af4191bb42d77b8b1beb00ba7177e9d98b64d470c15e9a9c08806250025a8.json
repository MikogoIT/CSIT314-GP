{"ast":null,"code":"import _objectSpread from\"D:/Study/Git/CSIT314-GP/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// 4. PIN历史记录页面\n// src/pages/PIN/History.jsx\nimport React,{useState,useEffect}from'react';import{useAuth}from'../../context/AuthContext';import{useLanguage}from'../../context/LanguageContext';import Navbar from'../../components/Layout/Navbar';import RequestDetailModal from'../../components/PIN/RequestDetailModal';import'../../styles/history.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const PINHistory=()=>{const{user}=useAuth();const{t}=useLanguage();const[historyRecords,setHistoryRecords]=useState([]);const[filteredRecords,setFilteredRecords]=useState([]);const[showRequestDetail,setShowRequestDetail]=useState(null);const[filters,setFilters]=useState({serviceType:'',startDate:'',endDate:''});// 加载历史记录\nuseEffect(()=>{if(user!==null&&user!==void 0&&user.id){loadHistoryRecords();}},[user===null||user===void 0?void 0:user.id]);// 应用过滤器\nuseEffect(()=>{applyFilters();},[historyRecords,filters]);const loadHistoryRecords=()=>{// 从localStorage获取所有请求\nconst allRequests=JSON.parse(localStorage.getItem('userRequests')||'[]');// 过滤出当前用户已完成（matched）的请求\nconst userCompletedRequests=allRequests.filter(request=>request.requesterId===user.id&&request.status==='matched'&&request.matchedAt// 确保有匹配时间\n);// 按匹配时间降序排序\nconst sortedRecords=userCompletedRequests.sort((a,b)=>new Date(b.matchedAt)-new Date(a.matchedAt));setHistoryRecords(sortedRecords);};const applyFilters=()=>{let filtered=[...historyRecords];// 按服务类型过滤\nif(filters.serviceType){filtered=filtered.filter(record=>record.category===filters.serviceType);}// 按日期范围过滤\nif(filters.startDate){filtered=filtered.filter(record=>{const matchDate=new Date(record.matchedAt);const startDate=new Date(filters.startDate);return matchDate>=startDate;});}if(filters.endDate){filtered=filtered.filter(record=>{const matchDate=new Date(record.matchedAt);const endDate=new Date(filters.endDate);endDate.setHours(23,59,59,999);// 包含结束日期的整天\nreturn matchDate<=endDate;});}setFilteredRecords(filtered);};const handleFilterChange=(field,value)=>{setFilters(prev=>_objectSpread(_objectSpread({},prev),{},{[field]:value}));};const handleViewDetail=record=>{setShowRequestDetail(record);};const getCategoryText=category=>{// Use translation system directly for all categories\nreturn t(\"category.\".concat(category))||category;};const getUrgencyText=urgency=>{const urgencyMap={low:'低',medium:'中',high:'高',urgent:'紧急'};return urgencyMap[urgency]||urgency;};const getUrgencyColor=urgency=>{const colorMap={low:'success',medium:'warning',high:'danger',urgent:'critical'};return colorMap[urgency]||'default';};return/*#__PURE__*/_jsxs(\"div\",{className:\"page-container\",children:[/*#__PURE__*/_jsx(Navbar,{userType:\"pin\",user:user}),/*#__PURE__*/_jsx(\"div\",{className:\"main-content\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"history-page\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"page-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"page-title\",children:t('pin.history.title')}),/*#__PURE__*/_jsx(\"p\",{className:\"page-subtitle\",children:\"\\u67E5\\u770B\\u60A8\\u7684\\u5386\\u53F2\\u5339\\u914D\\u8BB0\\u5F55\\u548C\\u5B8C\\u6210\\u7684\\u670D\\u52A1\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"filters-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"filters\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u670D\\u52A1\\u7C7B\\u578B\"}),/*#__PURE__*/_jsxs(\"select\",{value:filters.serviceType,onChange:e=>handleFilterChange('serviceType',e.target.value),className:\"filter-select\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:t('pin.history.allServiceTypes')}),/*#__PURE__*/_jsx(\"option\",{value:\"medical\",children:t('category.medical')}),/*#__PURE__*/_jsx(\"option\",{value:\"transport\",children:t('category.transport')}),/*#__PURE__*/_jsx(\"option\",{value:\"shopping\",children:t('category.shopping')}),/*#__PURE__*/_jsx(\"option\",{value:\"household\",children:t('category.household')}),/*#__PURE__*/_jsx(\"option\",{value:\"companion\",children:t('category.companion')})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u5F00\\u59CB\\u65E5\\u671F\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:filters.startDate,onChange:e=>handleFilterChange('startDate',e.target.value),className:\"filter-input\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u7ED3\\u675F\\u65E5\\u671F\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:filters.endDate,onChange:e=>handleFilterChange('endDate',e.target.value),className:\"filter-input\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"filter-actions\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary\",onClick:()=>setFilters({serviceType:'',startDate:'',endDate:''}),children:\"\\u6E05\\u9664\\u8FC7\\u6EE4\\u5668\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"results-count\",children:[\"\\u627E\\u5230 \",filteredRecords.length,\" \\u6761\\u5386\\u53F2\\u8BB0\\u5F55\"]})]}),filteredRecords.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"history-list\",children:filteredRecords.map(record=>{var _record$location;return/*#__PURE__*/_jsxs(\"div\",{className:\"history-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card-title\",children:[/*#__PURE__*/_jsx(\"h3\",{children:record.title}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-meta\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"category-badge\",children:getCategoryText(record.category)}),/*#__PURE__*/_jsx(\"span\",{className:\"urgency-badge urgency-\".concat(getUrgencyColor(record.urgency)),children:getUrgencyText(record.urgency)})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"match-info\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"volunteer-name\",children:[\"\\uD83D\\uDC64 \\u5FD7\\u613F\\u8005: \",record.volunteer||'未知']}),/*#__PURE__*/_jsxs(\"div\",{className:\"match-date\",children:[\"\\u2705 \\u5339\\u914D\\u65F6\\u95F4: \",new Date(record.matchedAt).toLocaleDateString('zh-CN')]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"description\",children:record.description}),/*#__PURE__*/_jsxs(\"div\",{className:\"service-details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"label\",children:\"\\uD83D\\uDCCD \\u670D\\u52A1\\u5730\\u70B9:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"value\",children:((_record$location=record.location)===null||_record$location===void 0?void 0:_record$location.address)||record.location||'待确定'})]}),record.expectedDate&&/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"label\",children:\"\\uD83D\\uDD52 \\u9884\\u671F\\u65F6\\u95F4:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"value\",children:[new Date(record.expectedDate).toLocaleDateString('zh-CN'),record.expectedTime&&\" \".concat(record.expectedTime)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"label\",children:\"\\uD83D\\uDCCA \\u7EDF\\u8BA1\\u4FE1\\u606F:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"value\",children:[\"\\u6D4F\\u89C8 \",record.viewCount||0,\" \\u6B21 \\u2022 \\u6536\\u85CF \",record.shortlistCount||0,\" \\u6B21\"]})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"card-actions\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:()=>handleViewDetail(record),children:\"\\u67E5\\u770B\\u8BE6\\u60C5\"})})]},record.id);})}):/*#__PURE__*/_jsxs(\"div\",{className:\"empty-state\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"empty-state-icon\",children:\"\\uD83D\\uDCCB\"}),/*#__PURE__*/_jsx(\"div\",{className:\"empty-state-title\",children:historyRecords.length===0?'暂无历史记录':'没有符合条件的记录'}),/*#__PURE__*/_jsx(\"div\",{className:\"empty-state-description\",children:historyRecords.length===0?'您还没有完成任何匹配的服务请求。创建请求并等待志愿者申请吧！':'尝试调整过滤条件查看更多记录'}),historyRecords.length===0&&/*#__PURE__*/_jsx(\"a\",{href:\"/pin/dashboard\",className:\"btn btn-primary\",children:\"\\u521B\\u5EFA\\u8BF7\\u6C42\"})]})]})}),showRequestDetail&&/*#__PURE__*/_jsx(RequestDetailModal,{request:showRequestDetail,onClose:()=>setShowRequestDetail(null)})]});};export default PINHistory;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}