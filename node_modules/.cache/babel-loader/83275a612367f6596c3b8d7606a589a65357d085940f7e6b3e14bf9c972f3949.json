{"ast":null,"code":"// Dashboard_new.jsx - é‡æ–°è®¾è®¡çš„çŽ°ä»£åŒ–ç®¡ç†å‘˜ä»ªè¡¨æ¿\nimport React,{useState,useEffect}from'react';import{Link}from'react-router-dom';import{useAuth}from'../../context/AuthContext';import{useLanguage}from'../../context/LanguageContext';import{DataService}from'../../services/dataService';import Navbar from'../../components/Layout/Navbar';import{isSystemAdmin,isPlatformManager}from'../../utils/permissions';import'../../styles/modern-dashboard.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AdminDashboard=()=>{var _user$name,_user$name$charAt;const{user}=useAuth();const{t}=useLanguage();const[dashboardData,setDashboardData]=useState({stats:[],activities:[]});const[loading,setLoading]=useState(true);const[lastUpdated,setLastUpdated]=useState(null);useEffect(()=>{// åŠ è½½ä»ªè¡¨æ¿æ•°æ®\nconst loadDashboardData=async()=>{try{// æ¸…ç©ºç¼“å­˜ï¼Œç¡®ä¿èŽ·å–æœ€æ–°æ•°æ®\nDataService.clearCache();// åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®\nawait DataService.initializeData();const statistics=await DataService.getStatistics();const users=await DataService.getUsers();const requests=await DataService.getRequests();// è®¡ç®—æœ¬æœˆæ–°å¢ž\nconst currentMonth=new Date().getMonth();const currentYear=new Date().getFullYear();const thisMonthUsers=(users||[]).filter(user=>{const userDate=new Date(user.registeredAt||user.createdAt||Date.now());return userDate.getMonth()===currentMonth&&userDate.getFullYear()===currentYear;});const thisMonthRequests=(requests||[]).filter(request=>{const requestDate=new Date(request.createdAt||Date.now());return requestDate.getMonth()===currentMonth&&requestDate.getFullYear()===currentYear;});// ä»Šæ—¥åŒ¹é…\nconst today=new Date();today.setHours(0,0,0,0);const todayMatched=(requests||[]).filter(request=>{if(request.status!=='matched')return false;const matchDate=new Date(request.matchedAt||request.updatedAt||request.createdAt);matchDate.setHours(0,0,0,0);return matchDate.getTime()===today.getTime();});const pendingRequests=(requests||[]).filter(r=>r.status==='pending');// æ ¹æ®ç®¡ç†å‘˜ç±»åž‹ç”Ÿæˆç»Ÿè®¡å¡ç‰‡\nconst allStats=[{title:t('admin.dashboard.totalUsers'),value:(users||[]).length.toString(),change:\"+\".concat(thisMonthUsers.length),trend:thisMonthUsers.length>0?'up':'neutral',icon:'ðŸ‘¥',color:'primary',permission:'system_admin'// åªæœ‰ System Admin å¯è§\n},{title:t('admin.dashboard.activeRequests'),value:(requests||[]).filter(r=>r.status==='pending'||r.status==='matched').length.toString(),change:\"+\".concat(thisMonthRequests.length),trend:thisMonthRequests.length>0?'up':'neutral',icon:'ðŸ“‹',color:'secondary',permission:'both'// ä¸¤ç§ç®¡ç†å‘˜éƒ½å¯è§\n},{title:t('admin.dashboard.todayMatches'),value:todayMatched.length.toString(),change:\"+\".concat(todayMatched.length),trend:todayMatched.length>0?'up':'neutral',icon:'âœ…',color:'success',permission:'platform_manager'// åªæœ‰ Platform Manager å¯è§\n},{title:t('admin.dashboard.pendingReview'),value:pendingRequests.length.toString(),change:\"\".concat(pendingRequests.length>5?'+':'').concat(pendingRequests.length),trend:pendingRequests.length>5?'up':pendingRequests.length>0?'neutral':'down',icon:'â³',color:'warning',permission:'both'// ä¸¤ç§ç®¡ç†å‘˜éƒ½å¯è§\n}];// æ ¹æ®ç”¨æˆ·æƒé™è¿‡æ»¤ç»Ÿè®¡å¡ç‰‡\nconst stats=allStats.filter(stat=>{if(stat.permission==='both')return true;if(stat.permission==='system_admin')return isSystemAdmin(user);if(stat.permission==='platform_manager')return isPlatformManager(user);return false;});// æœ€è¿‘æ´»åŠ¨ - æ ¹æ®ç®¡ç†å‘˜ç±»åž‹æ˜¾ç¤ºä¸åŒå†…å®¹\nconst activities=[];// System Admin æ˜¾ç¤ºæ–°ç”¨æˆ·æ´»åŠ¨\nif(isSystemAdmin(user)){const recentUsers=(users||[]).sort((a,b)=>new Date(b.registeredAt||b.createdAt||0)-new Date(a.registeredAt||a.createdAt||0)).slice(0,3);recentUsers.forEach(user=>{activities.push({icon:'ðŸ‘¤',content:\"\".concat(t('common.newUser'),\" - \").concat(user.name),time:DataService.getTimeAgo(user.registeredAt||user.createdAt,t)});});}// Platform Manager æ˜¾ç¤ºè¯·æ±‚å’ŒåŒ¹é…æ´»åŠ¨\nif(isPlatformManager(user)){const recentRequests=requests.sort((a,b)=>new Date(b.createdAt||0)-new Date(a.createdAt||0)).slice(0,5);// èŽ·å–æ‰€æœ‰åˆ†ç±»ä»¥ä¾¿åŽç»­æŸ¥æ‰¾\nconst allCategories=await DataService.getCategories();recentRequests.forEach(request=>{const icon=request.status==='matched'?'âœ…':'ðŸ“‹';const category=(allCategories||[]).find(cat=>cat.id===request.category);const categoryName=category?t(category.name):request.category;const content=request.status==='matched'?\"\".concat(categoryName).concat(t('common.requestMatched')):\"\".concat(t('common.newRequest'),\" - \").concat(categoryName);activities.push({icon,content,time:DataService.getTimeAgo(request.createdAt,t)});});}setDashboardData({stats,activities});setLastUpdated(new Date());}catch(error){console.error('åŠ è½½ä»ªè¡¨æ¿æ•°æ®å¤±è´¥:',error);setDashboardData({stats:[{title:t('admin.dashboard.totalUsers'),value:'0',change:'+0',trend:'neutral',icon:'ðŸ‘¥',color:'primary'},{title:t('admin.dashboard.activeRequests'),value:'0',change:'+0',trend:'neutral',icon:'ðŸ“‹',color:'secondary'},{title:t('admin.dashboard.todayMatches'),value:'0',change:'+0',trend:'neutral',icon:'âœ…',color:'success'},{title:t('admin.dashboard.pendingReview'),value:'0',change:'+0',trend:'neutral',icon:'â³',color:'warning'}],activities:[]});}finally{setLoading(false);}};loadDashboardData();// å®šæ—¶åˆ·æ–°\nconst interval=setInterval(loadDashboardData,30000);return()=>clearInterval(interval);},[t]);// å¿«æ·åŠŸèƒ½å¡ç‰‡ - æ ¹æ®ç®¡ç†å‘˜ç±»åž‹æ˜¾ç¤ºä¸åŒçš„åŠŸèƒ½\nconst getQuickActions=()=>{if(isSystemAdmin(user)){// System Admin ä¸“å±žåŠŸèƒ½\nreturn[{title:t('admin.dashboard.userManagement')||'User Management',icon:'ðŸ‘¥',path:'/admin/users',color:'blue',description:'Manage all users (#50)'},{title:t('admin.dashboard.systemLogs')||'System Logs',icon:'ðŸ“‹',path:'/admin/system-logs',color:'orange',description:'Monitor login activity (#51)'},{title:t('admin.dashboard.systemSettings')||'System Settings',icon:'âš™ï¸',path:'/admin/settings',color:'gray',description:'Configure system (#56)'},{title:t('admin.dashboard.alerts')||'Alerts',icon:'ðŸ””',path:'/admin/alerts',color:'red',description:'System alerts'}];}else if(isPlatformManager(user)){// Platform Manager ä¸“å±žåŠŸèƒ½\nreturn[{title:t('admin.dashboard.serviceCategories')||'Service Categories',icon:'ðŸ“',path:'/admin/categories',color:'green',description:'Manage categories (#57)'},{title:t('admin.dashboard.dataReports')||'Reports',icon:'ðŸ“Š',path:'/admin/reports',color:'purple',description:'Generate reports (#58)'},{title:t('admin.dashboard.participation')||'Participation',icon:'ðŸ“ˆ',path:'/admin/participation',color:'blue',description:'Monitor engagement (#59)'},{title:t('admin.dashboard.csrPerformance')||'CSR Performance',icon:'â­',path:'/admin/performance',color:'yellow',description:'Track CSR (#62)'}];}return[];};const quickActions=getQuickActions();return/*#__PURE__*/_jsxs(\"div\",{className:\"modern-admin-container\",children:[/*#__PURE__*/_jsx(Navbar,{userType:\"admin\",user:user}),/*#__PURE__*/_jsxs(\"div\",{className:\"modern-main-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"modern-dashboard-header\",children:/*#__PURE__*/_jsx(\"div\",{className:\"header-background\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header-main\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header-avatar\",children:[user!==null&&user!==void 0&&user.avatar?/*#__PURE__*/_jsx(\"img\",{src:user.avatar,alt:\"User Avatar\",className:\"avatar-image\"}):/*#__PURE__*/_jsx(\"div\",{className:\"avatar-icon\",children:(user===null||user===void 0?void 0:(_user$name=user.name)===null||_user$name===void 0?void 0:(_user$name$charAt=_user$name.charAt(0))===null||_user$name$charAt===void 0?void 0:_user$name$charAt.toUpperCase())||'ðŸ‘¨â€ðŸ’¼'}),/*#__PURE__*/_jsx(\"div\",{className:\"avatar-status\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"header-text\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"modern-dashboard-title\",children:t('admin.dashboard.title')}),/*#__PURE__*/_jsxs(\"p\",{className:\"welcome-text\",children:[t('admin.dashboard.welcome')||'æ¬¢è¿Žå›žæ¥',\", \",/*#__PURE__*/_jsx(\"span\",{className:\"user-name\",children:user===null||user===void 0?void 0:user.name})]}),/*#__PURE__*/_jsx(\"div\",{className:\"dashboard-subtitle\",children:t('admin.dashboard.description')||'ç³»ç»Ÿç®¡ç†ä¸Žæ•°æ®ç›‘æŽ§ä¸­å¿ƒ'})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"header-status\",children:lastUpdated&&/*#__PURE__*/_jsxs(\"div\",{className:\"update-indicator\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"update-icon\",children:\"\\uD83D\\uDD04\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"update-text\",children:[t('time.updatedAt')||'æ›´æ–°äºŽ',\": \",lastUpdated.toLocaleTimeString()]})]})})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"dashboard-actions-card\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"actions-container\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"modern-action-btn refresh-btn\",onClick:()=>{setLoading(true);setTimeout(()=>{window.location.reload();},500);},disabled:loading,children:[/*#__PURE__*/_jsx(\"span\",{className:\"btn-icon\",children:loading?'â³':'ðŸ”„'}),/*#__PURE__*/_jsx(\"span\",{className:\"btn-text\",children:loading?t('common.refreshing')||'åˆ·æ–°ä¸­':t('admin.dashboard.refreshData')||'åˆ·æ–°æ•°æ®'})]}),isPlatformManager(user)&&/*#__PURE__*/_jsxs(\"button\",{className:\"modern-action-btn export-btn\",onClick:async()=>{try{const statistics=await DataService.getStatistics();const users=await DataService.getUsers();const requests=await DataService.getRequests();const report={title:'System Report',generatedAt:new Date().toISOString(),statistics,summary:{totalUsers:(users||[]).length,totalRequests:(requests||[]).length,activeRequests:(requests||[]).filter(r=>r.status==='pending'||r.status==='matched').length,matchedRequests:(requests||[]).filter(r=>r.status==='matched').length}};const dataStr=JSON.stringify(report,null,2);const dataBlob=new Blob([dataStr],{type:'application/json'});const link=document.createElement('a');link.href=URL.createObjectURL(dataBlob);link.download=\"system_report_\".concat(new Date().toISOString().split('T')[0],\".json\");document.body.appendChild(link);link.click();document.body.removeChild(link);alert(t('admin.dashboard.reportGenerated')||'æŠ¥å‘Šå·²ç”Ÿæˆ');}catch(error){console.error('ç”ŸæˆæŠ¥å‘Šå¤±è´¥:',error);alert(t('admin.dashboard.reportError')||'ç”ŸæˆæŠ¥å‘Šå¤±è´¥');}},children:[/*#__PURE__*/_jsx(\"span\",{className:\"btn-icon\",children:\"\\uD83D\\uDCCA\"}),/*#__PURE__*/_jsx(\"span\",{className:\"btn-text\",children:t('admin.dashboard.exportReport')||'å¯¼å‡ºæŠ¥å‘Š'})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"modern-stats-section\",children:/*#__PURE__*/_jsx(\"div\",{className:\"stats-grid\",children:loading?// åŠ è½½çŠ¶æ€\nArray.from({length:4}).map((_,index)=>/*#__PURE__*/_jsx(\"div\",{className:\"modern-stat-card loading\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"stat-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-icon loading-icon\",children:\"\\u23F3\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-title\",children:t('common.loading')||'åŠ è½½ä¸­'}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-value\",children:\"--\"}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-change\",children:\"-- --\"})]})]})},index)):dashboardData.stats.map((stat,index)=>/*#__PURE__*/_jsx(\"div\",{className:\"modern-stat-card \".concat(stat.color),children:/*#__PURE__*/_jsxs(\"div\",{className:\"stat-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-icon \".concat(stat.color),children:stat.icon}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-title\",children:stat.title}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-value\",children:stat.value}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-change \".concat(stat.trend),children:[stat.trend==='up'?'â†—':stat.trend==='down'?'â†˜':'â†’',stat.change,\" \",t('admin.dashboard.thisMonth')||'æœ¬æœˆ']})]})]})},index))})}),/*#__PURE__*/_jsx(\"div\",{className:\"modern-content-section\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"content-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modern-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card-title-section\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"card-icon\",children:\"\\u26A1\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"card-title\",children:t('admin.dashboard.quickActions')||'å¿«é€Ÿæ“ä½œ'})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsx(\"div\",{className:\"modern-actions-grid\",children:quickActions.map((action,index)=>/*#__PURE__*/_jsx(Link,{to:action.path,className:\"modern-action-card \".concat(action.color),children:/*#__PURE__*/_jsxs(\"div\",{className:\"action-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"action-icon \".concat(action.color),children:action.icon}),/*#__PURE__*/_jsx(\"div\",{className:\"action-title\",children:action.title}),/*#__PURE__*/_jsx(\"div\",{className:\"action-arrow\",children:\"\\u2192\"})]})},index))})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modern-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card-title-section\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"card-icon\",children:\"\\uD83D\\uDCC8\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"card-title\",children:t('admin.dashboard.recentActivity')||'æœ€è¿‘æ´»åŠ¨'})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:loading?/*#__PURE__*/_jsxs(\"div\",{className:\"activity-loading\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\",children:\"\\u23F3\"}),/*#__PURE__*/_jsx(\"p\",{children:t('common.loading')||'åŠ è½½ä¸­'})]}):dashboardData.activities.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"modern-activity-list\",children:dashboardData.activities.map((activity,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"modern-activity-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"activity-icon\",children:activity.icon}),/*#__PURE__*/_jsxs(\"div\",{className:\"activity-content\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"activity-text\",children:activity.content}),/*#__PURE__*/_jsx(\"span\",{className:\"activity-time\",children:activity.time})]})]},index))}):/*#__PURE__*/_jsxs(\"div\",{className:\"no-activity\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"no-activity-icon\",children:\"\\uD83D\\uDCCA\"}),/*#__PURE__*/_jsx(\"p\",{children:t('admin.dashboard.noRecentActivity')||'æš‚æ— æœ€è¿‘æ´»åŠ¨'})]})})]})]})})]})]});};export default AdminDashboard;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}